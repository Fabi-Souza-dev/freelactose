{% extends "base.html" %}

{% block title %}{{ produto.nome }}{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4">{{ produto.nome }}</h1>

    <div class="row mb-4">
        <div class="col-md-6 mb-3">
            {% if produto.imagem %}
            <img src="{{ url_for('static', filename='uploads/' + produto.imagem) }}" alt="{{ produto.nome }}"
                 class="img-fluid rounded shadow">
            {% else %}
            <div class="alert alert-warning">Este produto ainda não possui imagem.</div>
            {% endif %}
        </div>

        <div class="col-md-6">
            <h4>Descrição</h4>
            <p>{{ produto.descricao }}</p>

            <h4>Marca</h4>
            <p>{{ produto.marca }}</p>

            <h4>Categoria</h4>
            <p>{{ produto.categoria }}</p>
        </div>
    </div>

    <!-- Botões de ação -->
    <div class="mb-4 d-flex flex-wrap gap-2">
        <a href="{{ url_for('main.listar_produtos') }}" class="btn btn-outline-secondary">Voltar aos Produtos</a>

        {% if current_user.is_authenticated and current_user.id == produto.usuario_id %}
        <a href="{{ url_for('main.editar_produto', id=produto.id) }}" class="btn btn-primary">Editar Produto</a>
        <form action="{{ url_for('main.excluir_produto', id=produto.id) }}" method="POST" class="d-inline">
            {{ form_exclusao.csrf_token }}
            <button type="submit" class="btn btn-danger"
                    onclick="return confirm('Tem certeza que deseja excluir este produto?')">
                Excluir Produto
            </button>
        </form>

        {% endif %}
    </div>

    <!-- Avaliações já feitas -->
    <hr>
    <h4 class="mt-4">Avaliações dos Usuários</h4>

    {% if avaliacoes %}
    {% for a in avaliacoes %}
    <div class="card mt-3">
        <div class="card-body">
            <h5 class="card-title">Nota: {{ a.nota }}</h5>
            <p class="card-text">{{ a.comentario }}</p>
            <small class="text-muted">Por {{ a.autor.nome_usuario }} em {{ a.data_avaliacao.strftime('%d/%m/%Y')
                }}</small>
            {% if current_user.is_authenticated and a.usuario_id == current_user.id %}
            <div class="mt-2">
                <a href="{{ url_for('main.editar_avaliacao', id=a.id) }}" class="btn btn-sm btn-primary">Editar</a>
                <form action="{{ url_for('main.excluir_avaliacao', id=a.id) }}" method="post" style="display:inline;">
                    {{ form_exclusao.csrf_token }}
                    <button type="submit" class="btn btn-sm btn-danger">Excluir</button>
                </form>
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
    {% else %}
    <p class="text-muted">Ainda não há avaliações para este produto.</p>
    {% endif %}


</div>
{% endblock %}
